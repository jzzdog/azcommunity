<%- model_class = Post -%>
<div class="page-header">
  <h1>Публикации</h1>
</div>

<% if params[:topic] %>
  <ul class="breadcrumb">
    <li><%= link_to 'Форум', forum_index_path %> / </span></li>  
    <li><%= link_to Topic.find(params[:topic]).name, posts_index_path(params[:topic])%></li>  
  </ul>
<% end %>



<% if @posts %>   

  <table class="table table-bordered">

    <% @posts.each do |post| %>
    <tr>  
      <td width="80px">
        <% if post.user_id && User.find(post.user_id) %>          
          <em><small><span><%= User.find(post.user_id).get_user_info() %></span></small></em> 
        <% end %>
        <p><small><span><%= post.created_at.strftime("%d.%m.%Y в %k:%m") %></span></small></p>
      </td>     
      <td>
        <p><%= link_to post.title, post_path(post), :style=>'font-size:12pt'%></p>        
        <p><%= sanitize(post.body)%></p>        
        
        <% if session[:user_id] == post.user_id %>
            <span><%= link_to 'редактировать', edit_post_path(post), :style=>"color:gray" %> </span>
        <% end %>
        
      </td>
    </tr>
    <% end %>
  </table>

  <% if params[:topic] %>
    <p class="muted">Всего публикаций: <%= Post.where(:topic_id => params[:topic]).count %> </p>
  <% else %>
    <p class="muted">Всего публикаций: <%= Post.count %> </p>
  <% end %>
  
<% end %>


<div class="form-actions1">
<%= link_to 'Новый пост',
            new_post_path(params),
            :class => 'btn btn-primary' %>
</div>

<br>



